## 待办事项

- 多核实现
- 修改用户地址空间映射，使其能够使用更大的虚拟空间
- 目前用户和内核的堆空间是定死的，有没有办法优化下？
- 对于`vm_area`（即linux中的`vma_area_struct`），需要保存指向他的所有进程指针，因为可能作为共享库.
- 目前MMIO的地址是`Identical`映射，这样会导致用户空间变小，最好是将MMIO的映射到内核高地址，但不知道为啥这样会导致读不到memory-map寄存器
- 目前调度器为FIFO，并且每次切换任务都会刷一次表，实际上同一进程内的线程切换并不需要刷表，可以考虑将同一进程的任务优先调度执行
- 目前在`read`,`write`等系统调用未读到数据的时候是直接`yield`，即放到任务队列的末尾，感觉可以将其状态设为sleep，然后等读到数据发生中断的时候再唤醒该任务.
- 信号系统
- 目前所有的锁都不能跨await，是不是可以参考tokio实现一个可以await的锁？
- 给每一处unsafe都加上safety保证
- 使用radix-tree来组织mmap区域
- 当clone出一个新的线程时，应该在内核态添加exit调用，而不是像现在这样在用户态封装函数
- - [x] 目前clone中传入的函数指针是用户自定义的wrapper，并不符合posix标准，需要重构
- 目前用户自定义信号处理函数必须在最后手动调用`sigreturn`，是否能够让内核自动添加？
- 信号系统目前还未完善，如上述一点，另外可以支持设置信号栈
- 共享内存
- 测试单核和多核的性能
- per-CPU allocator:每个核心一个内存分配器，减少锁的争抢
- per-CPU page frame
- 优化：内核线程使用全局页表，实际上可以直接用上一个用户线程的内核映射部分来减少tlb的刷新
- 手写外设驱动，而不是直接通过rust-sbi代理，这样可以通过中断高效处理io
- 修改virtio驱动，不过优先级应该不太大？（毕竟决赛不需要用到了）
- - [x] 栈追踪器完善（目前如果是内核线程的话是无法开启的）
- 修改page_fault_handler中的接口定义，感觉不是很合理
- 压力测试，测试内核是否健壮
- 目前内核态全程关中断，是否需要修改？
- trap快速路径
- 更新rust-sbi
- 添加`xtask`，便于管理项目编译构建流程
- 将所有的`lookup_from_root_tmp`替换
- FileSystemMeta相关方法重构
- 重构mmap中的backup file结构，用inode而不是用file
